<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Inventory</title>
  <link rel="stylesheet" href="style.css">

  <!-- Firebase SDK -->
  <script type="module">
    // Firebase Configuration
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
    import { getFirestore, collection, getDocs } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyBmiLbt-SgIRN4yjoCX6iGTsdvQ4HDz554",
      authDomain: "brian-inventory-management.firebaseapp.com",
      projectId: "brian-inventory-management",
      storageBucket: "brian-inventory-management.firebasestorage.app",
      messagingSenderId: "276972422558",
      appId: "1:276972422558:web:c1ef8577015f3a9097428f",
      measurementId: "G-HW9K6R9WKM",
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // Reference the inventory collection
    const inventoryRef = collection(db, "inventory");

    // Function to display inventory data
    async function displayInventory() {
      console.log("Fetching inventory data...");

      try {
        const querySnapshot = await getDocs(inventoryRef);
        console.log("Firestore data retrieved: ", querySnapshot.empty ? "No data found" : "Data found");

        const inventoryList = document.getElementById("inventory-list");
        inventoryList.innerHTML = ""; // Clear existing content

        if (querySnapshot.empty) {
          inventoryList.innerHTML = "<p>No inventory data found.</p>";
        } else {
          querySnapshot.forEach((doc) => {
            const data = doc.data(); // Get fields (items and quantities)
            const category = doc.id; // Get document ID (e.g., Mountain Bike)
            const categoryDiv = document.createElement("div");

            console.log('Category:', category, 'Data:', data); // Debugging: log category and data

            // Generate HTML for this category using template literals
            let categoryHtml = `<h2>${category}</h2><ul>`;
            for (const [item, qty] of Object.entries(data)) {
              // Add each item and its quantity
              categoryHtml += `<li>${item}: ${qty}</li>`;
            }
            categoryHtml += "</ul>";

            // Append the category to the page
            categoryDiv.innerHTML = categoryHtml;
            inventoryList.appendChild(categoryDiv);
          });
        }
      } catch (error) {
        console.error("Error retrieving inventory: ", error);
      }
    }

    // Call the function on page load
    displayInventory();
  </script>
</head>
<body>
  <header>
    <nav>
      <ul>
        <li><a href="index.html">Home</a></li>
        <li><a href="inventory.html">Inventory</a></li>
        <li><a href="stock-control.html">Stock Control</a></li>
        <li><a href="repairs.html">Repairs</a></li>
      </ul>
    </nav>
  </header>

  <main>
    <h1>Inventory</h1>
    <div id="inventory-list">
      <!-- Inventory data will be populated here -->
    </div>
  </main>
</body>
</html>
