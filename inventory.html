function doPost(e) {
  try {
    const data = JSON.parse(e.postData.contents);

    // Open the spreadsheet and access the sheet
    const sheet = SpreadsheetApp.openById("1KUrgcWTWvhZcL2Is4zXwp9MJ25HtmHlGxtesnGg_Eo8").getSheetByName("Repairs");
    if (!sheet) throw new Error("Repairs sheet not found.");

    // Append the received data to the sheet
    sheet.appendRow([
      new Date(), // Timestamp
      data.repairedItem,
      data.assetID,
      data.repairDetails,
      data.stockUsed,
      JSON.stringify(data.stockItems),
    ]);

    // Return a success response with CORS headers
    return ContentService.createTextOutput(JSON.stringify({ status: "success", message: "Repair logged successfully." }))
      .setMimeType(ContentService.MimeType.JSON)
      .setHeaders({
        "Access-Control-Allow-Origin": "*", // Allow all origins
        "Access-Control-Allow-Methods": "POST, OPTIONS", // Allow POST and OPTIONS methods
        "Access-Control-Allow-Headers": "Content-Type", // Allow specific headers
      });
  } catch (err) {
    // Return an error response with CORS headers
    return ContentService.createTextOutput(JSON.stringify({ status: "error", message: err.message }))
      .setMimeType(ContentService.MimeType.JSON)
      .setHeaders({
        "Access-Control-Allow-Origin": "*", // Allow all origins
        "Access-Control-Allow-Methods": "POST, OPTIONS",
        "Access-Control-Allow-Headers": "Content-Type",
      });
  }
}

function doOptions(e) {
  // Handle preflight requests with CORS headers
  return ContentService.createTextOutput("")
    .setMimeType(ContentService.MimeType.JSON)
    .setHeaders({
      "Access-Control-Allow-Origin": "*", // Allow all origins
      "Access-Control-Allow-Methods": "POST, OPTIONS",
      "Access-Control-Allow-Headers": "Content-Type",
    });
}
